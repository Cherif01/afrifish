<div class="container-fluid mt-4">
  <!-- Header avec titre et bouton -->
  <div class="card g-4">
    <div class="row">
      <div class="col text-start">
        <h4 class="text-uppercase fw-bold">{{ title }}</h4>
      </div>
      <div class="col text-right">
        <button
          mat-raised-button
          color="primary"
          routerLink="/operation/client-vente"
        >
          <mat-icon>add</mat-icon>
          Initier Une Vente
        </button>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <!-- Tableau -->
    <div class="col">
      <mat-card class="shadow-sm">
        <div class="table-responsive p-3">
          <h3 class="form-title text-center text-primary mb-3">
            Listes des Ventes
          </h3>
          <mat-form-field class="w-100 mb-3" appearance="outline">
            <mat-label>Rechercher...</mat-label>
            <input
              matInput
              (keyup)="applyFilter($event)"
              placeholder="Rechercher"
              #input
            />
          </mat-form-field>

          <table
            mat-table
            [dataSource]="dataSource"
            id="maTable"
            class="mat-elevation-z8"
          >
            <!-- ID Column -->
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef>#</th>
              <td mat-cell *matCellDef="let i = index">{{ i + 1 }}</td>
            </ng-container>

            <!-- Client Column -->
            <ng-container matColumnDef="Nomcompletclient">
              <th mat-header-cell *matHeaderCellDef>Clients</th>
              <td mat-cell *matCellDef="let element">
                {{ element.Nomcompletclient }} <br />
                <span class="text-blue">de : {{ element.reference }}</span>
                <br />
                <span class="text-red">{{ element.telephone }}</span>
              </td>
            </ng-container>

            <!-- Montant Total Column -->
            <ng-container matColumnDef="montantTotal">
              <th mat-header-cell *matHeaderCellDef>Montant Total</th>
              <td mat-cell *matCellDef="let element">
                {{ element.montantTotal | currency : "GNF: " }}
              </td>
            </ng-container>

            <!-- Montant Payé Column -->
            <ng-container matColumnDef="montantPaye">
              <th mat-header-cell *matHeaderCellDef>Montant Payé</th>
              <td mat-cell *matCellDef="let element">
                {{ element.montantPaye | currency : "GNF: " }}
              </td>
            </ng-container>

            <!-- Reste à Payer Column -->
            <ng-container matColumnDef="resteAPayer">
              <th mat-header-cell *matHeaderCellDef>Reste à Payer</th>
              <td mat-cell *matCellDef="let element">
                {{ element.resteAPayer | currency : "GNF: " }}
              </td>
            </ng-container>

            <!-- Statut Column -->
            <ng-container matColumnDef="etat">
              <th mat-header-cell *matHeaderCellDef>Etat</th>
              <td mat-cell *matCellDef="let element">
                <span *ngIf="element.statut==='valider'"
                  [ngClass]="{
                    'badge-valid': element.etat === 'Payé',
                    'badge-en-attente':
                      element.etat === 'En attente de paiement'
                  }"
                >
                  {{ element.etat }}
                </span>
              </td>
            </ng-container>
            <ng-container matColumnDef="statut">
              <th mat-header-cell *matHeaderCellDef>Statut Vente</th>
              <td mat-cell *matCellDef="let element">
                <span
                  [ngClass]="{
                    'badge-en-cours': element.statut === 'en cours',
                    'badge-valider': element.statut === 'valider'
                  }"
                >
                  {{ element.statut }}
                </span>
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let element">
                <div class="d-flex gap-2 justify-content-center">
                  <!-- Edit Button -->
                  <button
                    *ngIf="element.statut === 'en cours'"
                    mat-stroked-button
                    class="mx-2"
                    color="primary"
                    routerLink="/operation/panier-vente/{{ element.id }}"
                  >
                    <mat-icon>edit</mat-icon>
                  </button>
                  <!-- Facture Button -->
                  <button
                    mat-stroked-button
                    class="mx-2"
                    color="warn"
                    routerLink="/operation/facture-vente/{{ element.id }}"
                  >
                    <mat-icon>visibility</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <!-- Header and Row -->
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>

          <mat-paginator
            [pageSizeOptions]="[5, 10, 20]"
            showFirstLastButtons
          ></mat-paginator>
        </div>
      </mat-card>
    </div>
  </div>
</div>
